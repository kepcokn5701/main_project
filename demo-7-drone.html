<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>드론 영상 송전설비 판독 | AI Drone Inspection</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: { sans: ['Noto Sans KR', 'sans-serif'] },
      colors: {
        base: { 900: '#070b16', 800: '#0c1221', 700: '#111827', 600: '#1a2332' },
        cyan: { 400: '#22d3ee', 500: '#06b6d4', 600: '#0891b2' },
        teal: { 400: '#2dd4bf', 500: '#14b8a6' }
      }
    }
  }
}
</script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans KR', sans-serif; background: #070b16; color: #e2e8f0; overflow-x: hidden; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: #0c1221; }
::-webkit-scrollbar-thumb { background: #1e3a5f; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #22d3ee; }

/* Video Player */
.video-container {
  position: relative;
  background: #050810;
  border: 1px solid rgba(34,211,238,0.15);
  border-radius: 8px;
  overflow: hidden;
  aspect-ratio: 16/9;
}

/* Transmission Tower SVG-like drawing via CSS */
.tower-silhouette {
  position: absolute;
  inset: 0;
  opacity: 0.25;
}
.tower-silhouette::before {
  content: '';
  position: absolute;
  left: 50%;
  top: 10%;
  width: 2px;
  height: 80%;
  background: linear-gradient(to bottom, #94a3b8, #475569);
  transform: translateX(-50%);
}
.tower-silhouette::after {
  content: '';
  position: absolute;
  left: 50%;
  top: 8%;
  width: 0;
  height: 0;
  border-left: 60px solid transparent;
  border-right: 60px solid transparent;
  border-bottom: 30px solid rgba(148,163,184,0.3);
  transform: translateX(-50%);
}

/* Tower arms */
.tower-arm {
  position: absolute;
  height: 2px;
  background: linear-gradient(to right, transparent, #94a3b8, transparent);
}
.tower-arm-1 { top: 25%; left: 25%; width: 50%; }
.tower-arm-2 { top: 40%; left: 30%; width: 40%; }
.tower-arm-3 { top: 55%; left: 28%; width: 44%; }
.tower-arm-4 { top: 70%; left: 20%; width: 60%; }

/* Tower diagonal braces */
.tower-brace {
  position: absolute;
  width: 2px;
  background: rgba(148,163,184,0.3);
  transform-origin: top center;
}
.tower-brace-l1 { top: 25%; left: calc(50% - 30px); height: 15%; transform: rotate(-15deg); }
.tower-brace-r1 { top: 25%; left: calc(50% + 30px); height: 15%; transform: rotate(15deg); }
.tower-brace-l2 { top: 40%; left: calc(50% - 25px); height: 15%; transform: rotate(-12deg); }
.tower-brace-r2 { top: 40%; left: calc(50% + 25px); height: 15%; transform: rotate(12deg); }
.tower-brace-l3 { top: 55%; left: calc(50% - 28px); height: 15%; transform: rotate(-18deg); }
.tower-brace-r3 { top: 55%; left: calc(50% + 28px); height: 15%; transform: rotate(18deg); }

/* Insulators */
.insulator {
  position: absolute;
  width: 8px;
  height: 20px;
  border: 1px solid rgba(148,163,184,0.4);
  border-radius: 2px;
}

/* Scan Line */
.scan-line {
  position: absolute;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(to right, transparent, #22d3ee, rgba(34,211,238,0.6), #22d3ee, transparent);
  box-shadow: 0 0 15px rgba(34,211,238,0.5), 0 0 30px rgba(34,211,238,0.2);
  animation: scanDown 4s linear infinite;
  z-index: 5;
  opacity: 0;
  transition: opacity 0.3s;
}
.scan-line.active { opacity: 1; }

@keyframes scanDown {
  0% { top: 0%; }
  100% { top: 100%; }
}

/* Detection Bounding Boxes */
.detection-box {
  position: absolute;
  border-width: 2px;
  border-style: solid;
  border-radius: 2px;
  opacity: 0;
  transform: scale(1.1);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 10;
}
.detection-box.visible {
  opacity: 1;
  transform: scale(1);
}
.detection-box.red { border-color: #ef4444; box-shadow: 0 0 10px rgba(239,68,68,0.3), inset 0 0 10px rgba(239,68,68,0.05); }
.detection-box.green { border-color: #22c55e; box-shadow: 0 0 10px rgba(34,197,94,0.3), inset 0 0 10px rgba(34,197,94,0.05); }
.detection-box.yellow { border-color: #eab308; box-shadow: 0 0 10px rgba(234,179,8,0.3), inset 0 0 10px rgba(234,179,8,0.05); }

.detection-label {
  position: absolute;
  top: -24px;
  left: -2px;
  padding: 2px 8px;
  font-size: 11px;
  font-weight: 600;
  border-radius: 2px 2px 0 0;
  white-space: nowrap;
  letter-spacing: -0.02em;
}
.detection-box.red .detection-label { background: #ef4444; color: #fff; }
.detection-box.green .detection-label { background: #22c55e; color: #fff; }
.detection-box.yellow .detection-label { background: #eab308; color: #000; }

/* Crosshair corners on detection boxes */
.detection-box::before,
.detection-box::after {
  content: '';
  position: absolute;
  width: 8px;
  height: 8px;
}
.detection-box::before {
  top: -1px; left: -1px;
  border-top: 2px solid; border-left: 2px solid;
  border-color: inherit;
}
.detection-box::after {
  bottom: -1px; right: -1px;
  border-bottom: 2px solid; border-right: 2px solid;
  border-color: inherit;
}

/* Progress bar */
.progress-track {
  height: 4px;
  background: rgba(34,211,238,0.1);
  border-radius: 2px;
  overflow: hidden;
  cursor: pointer;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #06b6d4, #22d3ee);
  border-radius: 2px;
  transition: width 0.1s linear;
}

/* Minimap */
.minimap {
  position: relative;
  background: #0a0f1a;
  border: 1px solid rgba(34,211,238,0.15);
  border-radius: 6px;
  height: 140px;
  overflow: hidden;
}
.minimap-grid {
  position: absolute;
  inset: 0;
  background-image:
    linear-gradient(rgba(34,211,238,0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(34,211,238,0.05) 1px, transparent 1px);
  background-size: 20px 20px;
}
.minimap-tower {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  cursor: pointer;
  transition: all 0.3s;
}
.minimap-tower::after {
  content: attr(data-label);
  position: absolute;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 8px;
  white-space: nowrap;
  color: #94a3b8;
}
.minimap-tower.active {
  background: #22d3ee !important;
  box-shadow: 0 0 12px rgba(34,211,238,0.6);
  width: 12px;
  height: 12px;
}
.minimap-line {
  position: absolute;
  height: 1px;
  background: rgba(148,163,184,0.3);
  transform-origin: left center;
}

/* Tower list item */
.tower-item {
  padding: 10px 12px;
  border: 1px solid rgba(34,211,238,0.08);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  background: rgba(12,18,33,0.5);
}
.tower-item:hover { border-color: rgba(34,211,238,0.3); background: rgba(34,211,238,0.05); }
.tower-item.active { border-color: #22d3ee; background: rgba(34,211,238,0.1); }

/* Status badges */
.badge { padding: 2px 8px; border-radius: 9999px; font-size: 11px; font-weight: 500; }
.badge-done { background: rgba(34,197,94,0.15); color: #4ade80; }
.badge-progress { background: rgba(34,211,238,0.15); color: #22d3ee; }
.badge-wait { background: rgba(148,163,184,0.15); color: #94a3b8; }

/* Table */
.data-table { width: 100%; border-collapse: collapse; }
.data-table th {
  padding: 10px 12px;
  text-align: left;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: #94a3b8;
  border-bottom: 1px solid rgba(34,211,238,0.1);
  background: rgba(12,18,33,0.5);
}
.data-table td {
  padding: 10px 12px;
  font-size: 13px;
  border-bottom: 1px solid rgba(34,211,238,0.05);
}
.data-table tr:hover td { background: rgba(34,211,238,0.03); }

/* Stat card */
.stat-card {
  background: linear-gradient(135deg, rgba(12,18,33,0.8), rgba(26,35,50,0.5));
  border: 1px solid rgba(34,211,238,0.1);
  border-radius: 10px;
  padding: 16px 20px;
  transition: all 0.3s;
}
.stat-card:hover {
  border-color: rgba(34,211,238,0.3);
  transform: translateY(-1px);
  box-shadow: 0 4px 20px rgba(34,211,238,0.1);
}

/* Report modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(7,11,22,0.85);
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
  backdrop-filter: blur(4px);
}
.modal-overlay.active { opacity: 1; pointer-events: all; }
.modal-content {
  background: #0c1221;
  border: 1px solid rgba(34,211,238,0.2);
  border-radius: 12px;
  width: 90%;
  max-width: 700px;
  max-height: 85vh;
  overflow-y: auto;
  transform: translateY(20px) scale(0.97);
  transition: transform 0.3s;
  box-shadow: 0 25px 60px rgba(0,0,0,0.5);
}
.modal-overlay.active .modal-content { transform: translateY(0) scale(1); }

/* Thumbnail mock */
.thumb-mock {
  width: 100%;
  aspect-ratio: 4/3;
  background: linear-gradient(135deg, #111827, #1a2332);
  border: 1px solid rgba(34,211,238,0.1);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}
.thumb-mock::before {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 10px,
    rgba(34,211,238,0.03) 10px,
    rgba(34,211,238,0.03) 11px
  );
}

/* Animations */
@keyframes pulseGlow {
  0%, 100% { box-shadow: 0 0 5px rgba(34,211,238,0.3); }
  50% { box-shadow: 0 0 15px rgba(34,211,238,0.5); }
}
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-in {
  animation: fadeInUp 0.4s ease-out forwards;
}

/* Button styles */
.btn-primary {
  background: linear-gradient(135deg, #0891b2, #06b6d4);
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
.btn-primary:hover { background: linear-gradient(135deg, #06b6d4, #22d3ee); transform: translateY(-1px); }
.btn-secondary {
  background: rgba(34,211,238,0.1);
  color: #22d3ee;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  border: 1px solid rgba(34,211,238,0.2);
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
.btn-secondary:hover { background: rgba(34,211,238,0.2); border-color: rgba(34,211,238,0.4); }
.btn-danger {
  background: rgba(239,68,68,0.1);
  color: #f87171;
  padding: 5px 10px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 500;
  border: 1px solid rgba(239,68,68,0.2);
  cursor: pointer;
  transition: all 0.2s;
}
.btn-danger:hover { background: rgba(239,68,68,0.2); }

/* Video overlay info */
.video-overlay-info {
  position: absolute;
  z-index: 15;
  font-family: 'Courier New', monospace;
  font-size: 11px;
  color: rgba(34,211,238,0.8);
  text-shadow: 0 0 4px rgba(0,0,0,0.8);
}

/* Blinking recording dot */
@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}
.blink { animation: blink 1s infinite; }

/* Toast notification */
.toast {
  position: fixed;
  bottom: 30px;
  right: 30px;
  background: #0c1221;
  border: 1px solid rgba(34,211,238,0.3);
  border-radius: 8px;
  padding: 12px 20px;
  z-index: 200;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 13px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.toast.show { transform: translateY(0); opacity: 1; }
</style>
</head>
<body>
<!-- AI DATA DISCLAIMER START (AI기본법 준수) -->
<div id="ai-disclaimer-banner" style="position:fixed;top:0;left:0;right:0;z-index:99999;background:linear-gradient(135deg,#78350f,#92400e);border-bottom:2px solid #f59e0b;padding:8px 20px;display:flex;align-items:center;justify-content:center;gap:10px;font-family:Noto Sans KR,sans-serif;font-size:13px;color:#fef3c7;text-align:center;box-shadow:0 4px 16px rgba(0,0,0,.6);"><span style="font-size:18px;">&#x26A0;&#xFE0F;</span><span><strong style="color:#fde68a;">AI 생성 데이터 고지</strong> | 본 화면의 모든 데이터(성명, 연락처, 주소, 계량값, 요금 등)는 <strong style="text-decoration:underline;">AI가 생성한 가상 데이터</strong>이며, 실제 인물 기업 고객 정보와 일절 무관합니다. <span style="opacity:.75;">(AI기본법 준수)</span></span></div>
<div id="ai-disclaimer-spacer" style="height:40px;"></div>
<div id="ai-watermark" style="position:fixed;bottom:14px;right:14px;z-index:99998;background:rgba(120,53,15,.92);border:1px solid rgba(251,191,36,.45);border-radius:24px;padding:6px 16px;font-family:Noto Sans KR,sans-serif;font-size:11px;color:#fde68a;display:flex;align-items:center;gap:6px;backdrop-filter:blur(6px);box-shadow:0 4px 12px rgba(0,0,0,.4);pointer-events:none;">&#x1F916; AI 생성 가상 데이터</div>
<div id="ai-consent-overlay" style="position:fixed;inset:0;z-index:999999;background:rgba(0,0,0,.88);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;font-family:Noto Sans KR,sans-serif;"><div style="background:linear-gradient(145deg,#1a1a2e,#16213e);border:1px solid rgba(251,191,36,.3);border-radius:20px;padding:36px 32px;max-width:520px;width:90%;text-align:center;box-shadow:0 24px 48px rgba(0,0,0,.6);"><div style="width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#92400e,#b45309);display:flex;align-items:center;justify-content:center;margin:0 auto 20px;font-size:32px;">&#x26A0;&#xFE0F;</div><h2 style="color:#fde68a;font-size:20px;font-weight:700;margin-bottom:12px;">AI 생성 데이터 안내</h2><p style="color:#cbd5e1;font-size:14px;line-height:1.8;margin-bottom:8px;">본 시스템은 <strong style="color:#fbbf24;">프로토타입 시연 목적</strong>으로 제작되었습니다.</p><div style="background:rgba(251,191,36,.08);border:1px solid rgba(251,191,36,.2);border-radius:12px;padding:16px;margin:16px 0;text-align:left;"><p style="color:#fef3c7;font-size:13px;line-height:1.8;">&#x2022; 화면에 표시되는 <strong style="color:#fbbf24;">모든 데이터는 AI가 생성한 가상 데이터</strong>입니다.<br>&#x2022; 실제 인물, 기업, 고객, 설비 정보와 <strong style="color:#fbbf24;">일절 무관</strong>합니다.<br>&#x2022; 이름, 연락처, 주소, 계기번호, 요금 등 모든 수치는 허구입니다.<br>&#x2022; 본 고지는 <strong style="color:#fbbf24;">AI기본법</strong>을 준수합니다.</p></div><button onclick="document.getElementById('ai-consent-overlay').style.display='none';" style="background:linear-gradient(135deg,#b45309,#d97706);color:#fff;border:none;padding:12px 48px;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;font-family:Noto Sans KR,sans-serif;box-shadow:0 4px 16px rgba(217,119,6,.4);transition:transform .15s;">확인했습니다</button><p style="color:#64748b;font-size:11px;margin-top:14px;">이 안내를 확인해야 시스템을 이용하실 수 있습니다.</p></div></div>
<!-- AI DATA DISCLAIMER END -->

<!-- Top Navigation -->
<nav class="sticky top-0 z-50 border-b border-cyan-500/10" style="background: rgba(7,11,22,0.95); backdrop-filter: blur(12px);">
  <div class="max-w-[1600px] mx-auto px-4 h-14 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a href="index.html" class="flex items-center gap-2 text-cyan-400 hover:text-cyan-300 transition-colors text-sm font-medium">
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        돌아가기
      </a>
      <div class="w-px h-6 bg-cyan-500/20"></div>
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center">
          <i data-lucide="scan-eye" class="w-4 h-4 text-white"></i>
        </div>
        <div>
          <h1 class="text-sm font-bold text-white leading-tight">드론 영상 송전설비 판독</h1>
          <p class="text-[10px] text-slate-500 leading-tight">AI Drone Video Inspection · YOLOv8</p>
        </div>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-cyan-500/10 border border-cyan-500/20">
        <span class="w-2 h-2 rounded-full bg-green-400 blink"></span>
        <span class="text-xs text-cyan-300">실시간 분석 활성</span>
      </div>
      <div class="text-xs text-slate-500" id="currentTime"></div>
    </div>
  </div>
</nav>

<!-- Statistics Dashboard -->
<section class="max-w-[1600px] mx-auto px-4 mt-4">
  <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3" id="statsBar">
    <!-- Filled by JS -->
  </div>
</section>

<!-- Main Content -->
<main class="max-w-[1600px] mx-auto px-4 mt-4 pb-8">
  <div class="grid grid-cols-12 gap-4">

    <!-- Left Sidebar: Tower Selection -->
    <aside class="col-span-12 lg:col-span-2">
      <div class="rounded-xl border border-cyan-500/10 overflow-hidden" style="background: rgba(12,18,33,0.6);">
        <div class="px-3 py-3 border-b border-cyan-500/10 flex items-center gap-2">
          <i data-lucide="radio-tower" class="w-4 h-4 text-cyan-400"></i>
          <span class="text-xs font-semibold text-white">철탑 목록</span>
          <span class="ml-auto text-[10px] text-slate-500">5기</span>
        </div>
        <!-- Tower list -->
        <div class="p-2 space-y-2" id="towerList">
          <!-- Filled by JS -->
        </div>
        <!-- Minimap -->
        <div class="px-2 pb-2">
          <div class="text-[10px] text-slate-500 mb-1 px-1">노선 미니맵</div>
          <div class="minimap" id="minimap">
            <div class="minimap-grid"></div>
            <!-- Towers and lines added by JS -->
          </div>
        </div>
      </div>
    </aside>

    <!-- Center: Video Player -->
    <section class="col-span-12 lg:col-span-7">
      <!-- Video Player -->
      <div class="rounded-xl border border-cyan-500/10 overflow-hidden" style="background: rgba(12,18,33,0.6);">
        <div class="px-3 py-2 border-b border-cyan-500/10 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <i data-lucide="video" class="w-4 h-4 text-cyan-400"></i>
            <span class="text-xs font-semibold text-white" id="videoTitle">T-401 드론 영상 분석</span>
          </div>
          <div class="flex items-center gap-3 text-[10px]">
            <span class="text-slate-500" id="fpsIndicator">30 FPS · YOLOv8n</span>
            <span class="text-cyan-400 font-mono" id="frameCounter">프레임 0 / 2,400</span>
          </div>
        </div>

        <!-- Video Container -->
        <div class="video-container" id="videoContainer">
          <!-- Tower silhouette -->
          <div class="tower-silhouette">
            <div class="tower-arm tower-arm-1"></div>
            <div class="tower-arm tower-arm-2"></div>
            <div class="tower-arm tower-arm-3"></div>
            <div class="tower-arm tower-arm-4"></div>
            <div class="tower-brace tower-brace-l1"></div>
            <div class="tower-brace tower-brace-r1"></div>
            <div class="tower-brace tower-brace-l2"></div>
            <div class="tower-brace tower-brace-r2"></div>
            <div class="tower-brace tower-brace-l3"></div>
            <div class="tower-brace tower-brace-r3"></div>
            <!-- Insulators -->
            <div class="insulator" style="left:28%; top:24%;"></div>
            <div class="insulator" style="left:70%; top:24%;"></div>
            <div class="insulator" style="left:32%; top:39%;"></div>
            <div class="insulator" style="left:66%; top:39%;"></div>
            <div class="insulator" style="left:30%; top:54%;"></div>
            <div class="insulator" style="left:68%; top:54%;"></div>
          </div>

          <!-- Scan line -->
          <div class="scan-line" id="scanLine"></div>

          <!-- Detection boxes container -->
          <div id="detectionBoxes"></div>

          <!-- Video overlay info -->
          <div class="video-overlay-info" style="top:10px; left:12px;">
            <div class="flex items-center gap-1.5">
              <span class="w-2 h-2 rounded-full bg-red-500 blink"></span>
              <span class="text-red-400 text-[10px] font-bold">REC</span>
            </div>
            <div class="mt-1 text-[10px] text-slate-400" id="overlayTimestamp">2026-02-27 09:14:22</div>
          </div>
          <div class="video-overlay-info" style="top:10px; right:12px; text-align:right;">
            <div class="text-[10px]">GPS: 35.1796° N, 129.0756° E</div>
            <div class="text-[10px] mt-0.5">ALT: 85m · DIST: 12m</div>
          </div>
          <div class="video-overlay-info" style="bottom:50px; left:12px;">
            <div class="text-[10px]" id="overlayTower">철탑 T-401 · 154kV 울산선</div>
          </div>
          <div class="video-overlay-info" style="bottom:50px; right:12px; text-align:right;">
            <div class="text[10px]" id="overlayDetCount">탐지: <span class="text-yellow-400">0</span>건</div>
          </div>

          <!-- Playback controls bar -->
          <div class="absolute bottom-0 left-0 right-0 z-20" style="background: linear-gradient(to top, rgba(5,8,16,0.95), transparent);">
            <!-- Progress bar -->
            <div class="px-3 pt-4 pb-1">
              <div class="progress-track" id="progressTrack">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
              </div>
            </div>
            <!-- Controls -->
            <div class="px-3 pb-2.5 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <button id="btnPlay" class="w-8 h-8 flex items-center justify-center rounded-lg bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 transition-all" title="재생/일시정지">
                  <i data-lucide="play" class="w-4 h-4" id="playIcon"></i>
                </button>
                <button id="btnBackward" class="w-7 h-7 flex items-center justify-center rounded-lg hover:bg-white/5 text-slate-400 hover:text-white transition-all" title="10초 뒤로">
                  <i data-lucide="skip-back" class="w-3.5 h-3.5"></i>
                </button>
                <button id="btnForward" class="w-7 h-7 flex items-center justify-center rounded-lg hover:bg-white/5 text-slate-400 hover:text-white transition-all" title="10초 앞으로">
                  <i data-lucide="skip-forward" class="w-3.5 h-3.5"></i>
                </button>
                <button id="btnSpeed" class="px-2 h-7 rounded-lg hover:bg-white/5 text-slate-400 hover:text-white text-[11px] font-mono transition-all" title="배속 변경">
                  1.0x
                </button>
                <div class="w-px h-4 bg-slate-700 mx-1"></div>
                <span class="text-[11px] text-slate-500 font-mono" id="timeDisplay">00:00 / 01:20</span>
              </div>
              <div class="flex items-center gap-2">
                <button id="btnDetections" class="px-2 h-7 rounded-lg bg-cyan-500/10 border border-cyan-500/20 text-cyan-400 text-[11px] font-medium hover:bg-cyan-500/20 transition-all flex items-center gap-1">
                  <i data-lucide="box-select" class="w-3 h-3"></i>
                  탐지 표시
                </button>
                <button id="btnFullscreen" class="w-7 h-7 flex items-center justify-center rounded-lg hover:bg-white/5 text-slate-400 hover:text-white transition-all">
                  <i data-lucide="maximize-2" class="w-3.5 h-3.5"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Detection Results Table -->
      <div class="mt-4 rounded-xl border border-cyan-500/10 overflow-hidden" style="background: rgba(12,18,33,0.6);">
        <div class="px-3 py-2.5 border-b border-cyan-500/10 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <i data-lucide="list-checks" class="w-4 h-4 text-cyan-400"></i>
            <span class="text-xs font-semibold text-white">탐지 결과 목록</span>
            <span class="badge badge-progress ml-2" id="detCountBadge">12건</span>
          </div>
          <div class="flex items-center gap-2">
            <button class="btn-secondary text-[11px] py-1 px-3" onclick="filterTable('all')">전체</button>
            <button class="btn-secondary text-[11px] py-1 px-3" onclick="filterTable('bad')" style="color:#f87171; border-color:rgba(239,68,68,0.3);">불량</button>
            <button class="btn-secondary text-[11px] py-1 px-3" onclick="filterTable('warn')" style="color:#eab308; border-color:rgba(234,179,8,0.3);">주의</button>
            <button class="btn-secondary text-[11px] py-1 px-3" onclick="filterTable('ok')" style="color:#4ade80; border-color:rgba(34,197,94,0.3);">정상</button>
          </div>
        </div>
        <div class="overflow-x-auto" style="max-height:340px; overflow-y:auto;">
          <table class="data-table" id="detectionTable">
            <thead>
              <tr>
                <th style="width:30px;">#</th>
                <th>부위</th>
                <th>탐지결과</th>
                <th>신뢰도</th>
                <th>상태</th>
                <th>프레임</th>
                <th>조치</th>
              </tr>
            </thead>
            <tbody id="detectionTableBody">
              <!-- Filled by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Right Sidebar: Report & Actions -->
    <aside class="col-span-12 lg:col-span-3">
      <!-- Analysis Summary -->
      <div class="rounded-xl border border-cyan-500/10 overflow-hidden" style="background: rgba(12,18,33,0.6);">
        <div class="px-3 py-2.5 border-b border-cyan-500/10 flex items-center gap-2">
          <i data-lucide="bar-chart-3" class="w-4 h-4 text-cyan-400"></i>
          <span class="text-xs font-semibold text-white">분석 요약</span>
        </div>
        <div class="p-3" id="analysisSummary">
          <!-- Filled by JS -->
        </div>
      </div>

      <!-- Report Generation -->
      <div class="mt-4 rounded-xl border border-cyan-500/10 overflow-hidden" style="background: rgba(12,18,33,0.6);">
        <div class="px-3 py-2.5 border-b border-cyan-500/10 flex items-center gap-2">
          <i data-lucide="file-text" class="w-4 h-4 text-cyan-400"></i>
          <span class="text-xs font-semibold text-white">리포트 생성</span>
        </div>
        <div class="p-3 space-y-3">
          <p class="text-[11px] text-slate-400 leading-relaxed">
            선택된 철탑의 AI 분석 결과를 기반으로 자동 점검 보고서를 생성합니다.
            불량/주의 항목이 포함된 완전한 보고서가 생성됩니다.
          </p>
          <button class="btn-primary w-full justify-center" id="btnReport" onclick="generateReport()">
            <i data-lucide="sparkles" class="w-4 h-4"></i>
            리포트 자동 생성
          </button>
          <div class="flex gap-2">
            <button class="btn-secondary flex-1 justify-center text-[11px]" onclick="showToast('엑셀 파일 다운로드를 시작합니다.')">
              <i data-lucide="table" class="w-3 h-3"></i>
              엑셀 다운로드
            </button>
            <button class="btn-secondary flex-1 justify-center text-[11px]" onclick="showToast('PDF 파일 다운로드를 시작합니다.')">
              <i data-lucide="file-down" class="w-3 h-3"></i>
              PDF 다운로드
            </button>
          </div>
        </div>
      </div>

      <!-- Detection Log (Live) -->
      <div class="mt-4 rounded-xl border border-cyan-500/10 overflow-hidden" style="background: rgba(12,18,33,0.6);">
        <div class="px-3 py-2.5 border-b border-cyan-500/10 flex items-center gap-2">
          <i data-lucide="activity" class="w-4 h-4 text-cyan-400"></i>
          <span class="text-xs font-semibold text-white">실시간 탐지 로그</span>
        </div>
        <div class="p-2 space-y-1 max-h-[200px] overflow-y-auto" id="detectionLog">
          <!-- Filled by JS -->
        </div>
      </div>
    </aside>

  </div>
</main>

<!-- Report Modal -->
<div class="modal-overlay" id="reportModal">
  <div class="modal-content">
    <div class="px-5 py-4 border-b border-cyan-500/10 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center">
          <i data-lucide="clipboard-check" class="w-5 h-5 text-white"></i>
        </div>
        <div>
          <h3 class="text-sm font-bold text-white">AI 자동 점검 보고서</h3>
          <p class="text-[10px] text-slate-500">Drone Video Inspection Report</p>
        </div>
      </div>
      <button onclick="closeModal()" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center text-slate-400 hover:text-white transition-all">
        <i data-lucide="x" class="w-4 h-4"></i>
      </button>
    </div>
    <div class="p-5" id="reportContent">
      <!-- Filled by JS -->
    </div>
    <div class="px-5 py-3 border-t border-cyan-500/10 flex items-center justify-between">
      <span class="text-[10px] text-slate-500">자동 생성 · AI 신뢰도 검증 완료</span>
      <div class="flex gap-2">
        <button class="btn-secondary text-[11px]" onclick="showToast('엑셀 파일 다운로드를 시작합니다.'); closeModal();">
          <i data-lucide="table" class="w-3 h-3"></i>
          엑셀 다운로드
        </button>
        <button class="btn-primary text-[11px]" onclick="showToast('PDF 파일 다운로드를 시작합니다.'); closeModal();">
          <i data-lucide="file-down" class="w-3 h-3"></i>
          PDF 다운로드
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <i data-lucide="check-circle-2" class="w-4 h-4 text-green-400"></i>
  <span id="toastMsg"></span>
</div>

<script>
// ===== DATA =====
const towerData = {
  'T-401': {
    status: '완료', lat: 35.1796, lng: 129.0756, alt: 85,
    totalFrames: 2400, fps: 30,
    detections: [
      { part: '상부 애자 (A상)', result: '애자 크랙', confidence: 94, status: 'bad', frame: 347 },
      { part: '상부 애자 (B상)', result: '정상', confidence: 98, status: 'ok', frame: 412 },
      { part: '상부 애자 (C상)', result: '정상', confidence: 96, status: 'ok', frame: 478 },
      { part: '중부 금구류', result: '금구류 정상', confidence: 98, status: 'ok', frame: 623 },
      { part: '하부 금구류', result: '볼트 풀림', confidence: 91, status: 'bad', frame: 845 },
      { part: '주주재 (상부)', result: '정상', confidence: 95, status: 'ok', frame: 980 },
      { part: '주주재 (하부)', result: '부식 경미', confidence: 88, status: 'warn', frame: 1102 },
      { part: '수평재', result: '정상', confidence: 97, status: 'ok', frame: 1250 },
      { part: '사재', result: '정상', confidence: 93, status: 'ok', frame: 1380 },
      { part: '수목 이격거리', result: '수목 이격거리 부족', confidence: 87, status: 'warn', frame: 1520 },
      { part: '가공지선', result: '정상', confidence: 96, status: 'ok', frame: 1700 },
      { part: '완철', result: '정상', confidence: 94, status: 'ok', frame: 1850 },
    ],
    boxes: [
      { label: '애자 크랙 94%', x: 22, y: 18, w: 14, h: 12, color: 'red', frame: 347 },
      { label: '금구류 정상 98%', x: 55, y: 35, w: 16, h: 10, color: 'green', frame: 623 },
      { label: '수목 이격거리 부족 87%', x: 10, y: 65, w: 22, h: 18, color: 'yellow', frame: 1520 },
      { label: '볼트 풀림 91%', x: 60, y: 50, w: 12, h: 10, color: 'red', frame: 845 },
    ]
  },
  'T-402': {
    status: '완료', lat: 35.1812, lng: 129.0771, alt: 92,
    totalFrames: 2200, fps: 30,
    detections: [
      { part: '상부 애자 (A상)', result: '정상', confidence: 97, status: 'ok', frame: 280 },
      { part: '상부 애자 (B상)', result: '정상', confidence: 95, status: 'ok', frame: 350 },
      { part: '상부 애자 (C상)', result: '오손 발견', confidence: 89, status: 'warn', frame: 420 },
      { part: '중부 금구류', result: '정상', confidence: 96, status: 'ok', frame: 580 },
      { part: '하부 금구류', result: '정상', confidence: 94, status: 'ok', frame: 720 },
      { part: '주주재 (상부)', result: '정상', confidence: 98, status: 'ok', frame: 900 },
      { part: '주주재 (하부)', result: '정상', confidence: 93, status: 'ok', frame: 1050 },
      { part: '수평재', result: '정상', confidence: 97, status: 'ok', frame: 1180 },
      { part: '사재', result: '정상', confidence: 91, status: 'ok', frame: 1320 },
      { part: '가공지선', result: '정상', confidence: 95, status: 'ok', frame: 1500 },
      { part: '완철', result: '변형 의심', confidence: 84, status: 'warn', frame: 1680 },
    ],
    boxes: [
      { label: '애자 오손 89%', x: 65, y: 20, w: 13, h: 11, color: 'yellow', frame: 420 },
      { label: '완철 변형 84%', x: 28, y: 38, w: 15, h: 10, color: 'yellow', frame: 1680 },
      { label: '금구류 정상 96%', x: 48, y: 52, w: 14, h: 9, color: 'green', frame: 580 },
    ]
  },
  'T-403': {
    status: '진행중', lat: 35.1828, lng: 129.0788, alt: 78,
    totalFrames: 2600, fps: 30,
    detections: [
      { part: '상부 애자 (A상)', result: '정상', confidence: 96, status: 'ok', frame: 310 },
      { part: '상부 애자 (B상)', result: '애자 파손', confidence: 92, status: 'bad', frame: 390 },
      { part: '상부 애자 (C상)', result: '정상', confidence: 94, status: 'ok', frame: 460 },
      { part: '중부 금구류', result: '정상', confidence: 97, status: 'ok', frame: 640 },
      { part: '하부 금구류', result: '정상', confidence: 93, status: 'ok', frame: 800 },
      { part: '주주재 (상부)', result: '정상', confidence: 96, status: 'ok', frame: 970 },
      { part: '주주재 (하부)', result: '도장 박리', confidence: 86, status: 'warn', frame: 1130 },
      { part: '수평재', result: '정상', confidence: 95, status: 'ok', frame: 1280 },
      { part: '사재', result: '정상', confidence: 92, status: 'ok', frame: 1420 },
      { part: '수목 이격거리', result: '정상', confidence: 94, status: 'ok', frame: 1580 },
      { part: '가공지선', result: '단선 의심', confidence: 83, status: 'warn', frame: 1750 },
      { part: '완철', result: '정상', confidence: 96, status: 'ok', frame: 1900 },
      { part: '기초부', result: '정상', confidence: 91, status: 'ok', frame: 2050 },
    ],
    boxes: [
      { label: '애자 파손 92%', x: 42, y: 16, w: 15, h: 13, color: 'red', frame: 390 },
      { label: '도장 박리 86%', x: 55, y: 60, w: 18, h: 12, color: 'yellow', frame: 1130 },
      { label: '단선 의심 83%', x: 18, y: 42, w: 20, h: 8, color: 'yellow', frame: 1750 },
    ]
  },
  'T-404': {
    status: '대기', lat: 35.1845, lng: 129.0803, alt: 88,
    totalFrames: 0, fps: 30,
    detections: [],
    boxes: []
  },
  'T-405': {
    status: '대기', lat: 35.1860, lng: 129.0820, alt: 81,
    totalFrames: 0, fps: 30,
    detections: [],
    boxes: []
  }
};

// Minimap tower positions (percent-based)
const minimapPositions = {
  'T-401': { x: 15, y: 75 },
  'T-402': { x: 30, y: 55 },
  'T-403': { x: 50, y: 40 },
  'T-404': { x: 70, y: 30 },
  'T-405': { x: 88, y: 18 },
};

// ===== STATE =====
let selectedTower = 'T-401';
let isPlaying = false;
let currentFrame = 0;
let playSpeed = 1.0;
let showDetections = true;
let playInterval = null;
let currentFilter = 'all';

// ===== INIT =====
document.addEventListener('DOMContentLoaded', () => {
  lucide.createIcons();
  renderStats();
  renderTowerList();
  renderMinimap();
  selectTower('T-401');
  updateClock();
  setInterval(updateClock, 1000);
});

function updateClock() {
  const now = new Date();
  document.getElementById('currentTime').textContent =
    now.toLocaleString('ko-KR', { year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit' });
}

// ===== STATISTICS BAR =====
function renderStats() {
  const allDetections = Object.values(towerData).flatMap(t => t.detections);
  const bad = allDetections.filter(d => d.status === 'bad').length;
  const warn = allDetections.filter(d => d.status === 'warn').length;
  const ok = allDetections.filter(d => d.status === 'ok').length;
  const total = allDetections.length;
  const analyzed = Object.values(towerData).filter(t => t.status !== '대기').length;

  const stats = [
    { icon: 'radio-tower', label: '오늘 분석 철탑', value: `${analyzed}기`, color: 'text-cyan-400', bg: 'from-cyan-500/10 to-cyan-500/5' },
    { icon: 'scan-eye', label: '총 탐지', value: `${total}건`, color: 'text-blue-400', bg: 'from-blue-500/10 to-blue-500/5' },
    { icon: 'alert-triangle', label: '불량', value: `${bad}건`, color: 'text-red-400', bg: 'from-red-500/10 to-red-500/5' },
    { icon: 'alert-circle', label: '주의', value: `${warn}건`, color: 'text-yellow-400', bg: 'from-yellow-500/10 to-yellow-500/5' },
    { icon: 'check-circle-2', label: '정상', value: `${ok}건`, color: 'text-green-400', bg: 'from-green-500/10 to-green-500/5' },
    { icon: 'timer', label: '분석 시간 절감', value: '15분→2분/기', color: 'text-teal-400', bg: 'from-teal-500/10 to-teal-500/5' },
  ];

  document.getElementById('statsBar').innerHTML = stats.map(s => `
    <div class="stat-card bg-gradient-to-br ${s.bg}">
      <div class="flex items-center gap-2 mb-1">
        <i data-lucide="${s.icon}" class="w-3.5 h-3.5 ${s.color}"></i>
        <span class="text-[10px] text-slate-500">${s.label}</span>
      </div>
      <div class="text-lg font-bold ${s.color}">${s.value}</div>
    </div>
  `).join('');
  lucide.createIcons();
}

// ===== TOWER LIST =====
function renderTowerList() {
  const container = document.getElementById('towerList');
  container.innerHTML = Object.entries(towerData).map(([id, data]) => {
    const statusClass = data.status === '완료' ? 'badge-done' : data.status === '진행중' ? 'badge-progress' : 'badge-wait';
    const badCount = data.detections.filter(d => d.status === 'bad').length;
    const warnCount = data.detections.filter(d => d.status === 'warn').length;
    const isActive = id === selectedTower;
    return `
      <div class="tower-item ${isActive ? 'active' : ''}" onclick="selectTower('${id}')" data-tower="${id}">
        <div class="flex items-center justify-between mb-1">
          <span class="text-xs font-bold text-white">${id}</span>
          <span class="badge ${statusClass}">${data.status}</span>
        </div>
        <div class="flex items-center gap-2 text-[10px] text-slate-500">
          <span>탐지 ${data.detections.length}건</span>
          ${badCount > 0 ? `<span class="text-red-400">불량 ${badCount}</span>` : ''}
          ${warnCount > 0 ? `<span class="text-yellow-400">주의 ${warnCount}</span>` : ''}
        </div>
      </div>
    `;
  }).join('');
}

// ===== MINIMAP =====
function renderMinimap() {
  const minimap = document.getElementById('minimap');
  const ids = Object.keys(minimapPositions);

  // Draw lines between towers
  for (let i = 0; i < ids.length - 1; i++) {
    const a = minimapPositions[ids[i]];
    const b = minimapPositions[ids[i + 1]];
    const dx = b.x - a.x;
    const dy = b.y - a.y;
    const length = Math.sqrt(dx * dx + dy * dy);
    const angle = Math.atan2(dy, dx) * (180 / Math.PI);
    const line = document.createElement('div');
    line.className = 'minimap-line';
    line.style.cssText = `left:${a.x}%; top:${a.y}%; width:${length}%; transform:rotate(${angle}deg);`;
    minimap.appendChild(line);
  }

  // Draw tower dots
  ids.forEach(id => {
    const pos = minimapPositions[id];
    const dot = document.createElement('div');
    const data = towerData[id];
    const color = data.status === '완료' ? '#22c55e' : data.status === '진행중' ? '#22d3ee' : '#475569';
    dot.className = `minimap-tower ${id === selectedTower ? 'active' : ''}`;
    dot.style.cssText = `left:${pos.x}%; top:${pos.y}%; background:${color};`;
    dot.setAttribute('data-label', id);
    dot.setAttribute('data-tower', id);
    dot.onclick = () => selectTower(id);
    minimap.appendChild(dot);
  });
}

function updateMinimap() {
  document.querySelectorAll('.minimap-tower').forEach(dot => {
    const id = dot.getAttribute('data-tower');
    if (id === selectedTower) {
      dot.classList.add('active');
    } else {
      dot.classList.remove('active');
    }
  });
}

// ===== SELECT TOWER =====
function selectTower(id) {
  selectedTower = id;
  const data = towerData[id];

  // Stop playback
  stopPlayback();
  currentFrame = 0;

  // Update tower list highlight
  document.querySelectorAll('.tower-item').forEach(el => {
    el.classList.toggle('active', el.dataset.tower === id);
  });

  // Update minimap
  updateMinimap();

  // Update video overlay
  document.getElementById('videoTitle').textContent = `${id} 드론 영상 분석`;
  document.getElementById('overlayTower').textContent = `철탑 ${id} · 154kV 울산선`;
  document.getElementById('frameCounter').textContent = `프레임 0 / ${data.totalFrames.toLocaleString()}`;

  // Clear detection boxes
  document.getElementById('detectionBoxes').innerHTML = '';
  document.getElementById('overlayDetCount').innerHTML = `탐지: <span class="text-yellow-400">0</span>건`;

  // Reset progress
  document.getElementById('progressFill').style.width = '0%';
  document.getElementById('timeDisplay').textContent = `00:00 / ${formatTime(data.totalFrames / data.fps)}`;

  // Render detection table
  renderDetectionTable(data);

  // Render analysis summary
  renderAnalysisSummary(data, id);

  // Render detection log
  renderDetectionLog(data);

  // Update count badge
  document.getElementById('detCountBadge').textContent = `${data.detections.length}건`;
}

// ===== DETECTION TABLE =====
function renderDetectionTable(data) {
  const tbody = document.getElementById('detectionTableBody');
  if (data.detections.length === 0) {
    tbody.innerHTML = `<tr><td colspan="7" class="text-center text-slate-500 py-8 text-sm">분석 대기 중 · 데이터 없음</td></tr>`;
    return;
  }

  tbody.innerHTML = data.detections.map((d, i) => {
    const statusLabel = d.status === 'bad' ? '불량' : d.status === 'warn' ? '주의' : '정상';
    const statusColor = d.status === 'bad' ? 'text-red-400' : d.status === 'warn' ? 'text-yellow-400' : 'text-green-400';
    const statusBg = d.status === 'bad' ? 'bg-red-500/10' : d.status === 'warn' ? 'bg-yellow-500/10' : 'bg-green-500/10';
    const confColor = d.confidence >= 95 ? 'text-green-400' : d.confidence >= 90 ? 'text-cyan-400' : d.confidence >= 85 ? 'text-yellow-400' : 'text-orange-400';
    const show = currentFilter === 'all' || currentFilter === d.status;

    return `
      <tr data-status="${d.status}" style="${show ? '' : 'display:none'}">
        <td class="text-slate-500 font-mono text-[11px]">${(i + 1).toString().padStart(2, '0')}</td>
        <td class="text-white font-medium text-[12px]">${d.part}</td>
        <td class="${statusColor} text-[12px]">${d.result}</td>
        <td>
          <div class="flex items-center gap-2">
            <div class="w-12 h-1.5 rounded-full bg-slate-700 overflow-hidden">
              <div class="h-full rounded-full ${d.confidence >= 90 ? 'bg-cyan-400' : 'bg-yellow-400'}" style="width:${d.confidence}%"></div>
            </div>
            <span class="${confColor} font-mono text-[11px]">${d.confidence}%</span>
          </div>
        </td>
        <td><span class="px-2 py-0.5 rounded-full text-[10px] font-semibold ${statusBg} ${statusColor}">${statusLabel}</span></td>
        <td class="text-slate-400 font-mono text-[11px]">#${d.frame.toLocaleString()}</td>
        <td>
          ${d.status !== 'ok' ? `<button class="btn-danger" onclick="issueInspection('${selectedTower}', '${d.part}')">현장점검 지시</button>` : '<span class="text-[11px] text-slate-600">-</span>'}
        </td>
      </tr>
    `;
  }).join('');
}

function filterTable(filter) {
  currentFilter = filter;
  // Map filter values
  const filterMap = { 'all': 'all', 'bad': 'bad', 'warn': 'warn', 'ok': 'ok' };
  const rows = document.querySelectorAll('#detectionTableBody tr[data-status]');
  rows.forEach(row => {
    if (filter === 'all' || row.dataset.status === filterMap[filter]) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
}

// ===== ANALYSIS SUMMARY =====
function renderAnalysisSummary(data, towerId) {
  const container = document.getElementById('analysisSummary');
  const bad = data.detections.filter(d => d.status === 'bad').length;
  const warn = data.detections.filter(d => d.status === 'warn').length;
  const ok = data.detections.filter(d => d.status === 'ok').length;
  const total = data.detections.length;

  if (total === 0) {
    container.innerHTML = `
      <div class="text-center py-6">
        <i data-lucide="clock" class="w-8 h-8 text-slate-600 mx-auto mb-2"></i>
        <p class="text-sm text-slate-500">분석 대기 중</p>
        <p class="text-[11px] text-slate-600 mt-1">드론 비행 예정</p>
      </div>
    `;
    lucide.createIcons();
    return;
  }

  const badPct = total > 0 ? ((bad / total) * 100).toFixed(1) : 0;
  const warnPct = total > 0 ? ((warn / total) * 100).toFixed(1) : 0;
  const okPct = total > 0 ? ((ok / total) * 100).toFixed(1) : 0;

  container.innerHTML = `
    <div class="space-y-3">
      <!-- Tower info -->
      <div class="flex items-center justify-between px-2 py-2 rounded-lg bg-cyan-500/5 border border-cyan-500/10">
        <div>
          <div class="text-xs font-bold text-white">${towerId}</div>
          <div class="text-[10px] text-slate-500">154kV 울산선</div>
        </div>
        <div class="text-right">
          <div class="text-xs text-cyan-400 font-mono">${total}건 탐지</div>
          <div class="text-[10px] text-slate-500">${data.totalFrames.toLocaleString()} 프레임</div>
        </div>
      </div>

      <!-- Status distribution bar -->
      <div>
        <div class="flex items-center gap-1 mb-1.5">
          <div class="h-2 rounded-full bg-red-500" style="width:${badPct}%; min-width:${bad > 0 ? '4px' : '0'}"></div>
          <div class="h-2 rounded-full bg-yellow-500" style="width:${warnPct}%; min-width:${warn > 0 ? '4px' : '0'}"></div>
          <div class="h-2 rounded-full bg-green-500" style="width:${okPct}%; min-width:${ok > 0 ? '4px' : '0'}; flex:1;"></div>
        </div>
        <div class="grid grid-cols-3 gap-1 text-center">
          <div class="p-2 rounded-lg bg-red-500/5 border border-red-500/10">
            <div class="text-lg font-bold text-red-400">${bad}</div>
            <div class="text-[10px] text-slate-500">불량</div>
          </div>
          <div class="p-2 rounded-lg bg-yellow-500/5 border border-yellow-500/10">
            <div class="text-lg font-bold text-yellow-400">${warn}</div>
            <div class="text-[10px] text-slate-500">주의</div>
          </div>
          <div class="p-2 rounded-lg bg-green-500/5 border border-green-500/10">
            <div class="text-lg font-bold text-green-400">${ok}</div>
            <div class="text-[10px] text-slate-500">정상</div>
          </div>
        </div>
      </div>

      <!-- Key findings -->
      <div>
        <div class="text-[10px] text-slate-500 mb-1.5 font-semibold uppercase tracking-wider">주요 발견</div>
        <div class="space-y-1">
          ${data.detections.filter(d => d.status !== 'ok').map(d => {
            const color = d.status === 'bad' ? 'text-red-400 bg-red-500/5 border-red-500/10' : 'text-yellow-400 bg-yellow-500/5 border-yellow-500/10';
            const icon = d.status === 'bad' ? 'alert-triangle' : 'alert-circle';
            return `
              <div class="flex items-center gap-2 px-2 py-1.5 rounded border ${color}">
                <i data-lucide="${icon}" class="w-3 h-3 flex-shrink-0"></i>
                <span class="text-[11px] flex-1">${d.part}: ${d.result}</span>
                <span class="text-[10px] opacity-70">${d.confidence}%</span>
              </div>
            `;
          }).join('') || '<div class="text-[11px] text-slate-600 px-2">이상 항목 없음</div>'}
        </div>
      </div>
    </div>
  `;
  lucide.createIcons();
}

// ===== DETECTION LOG =====
function renderDetectionLog(data) {
  const container = document.getElementById('detectionLog');
  if (data.detections.length === 0) {
    container.innerHTML = `<div class="text-center py-4 text-[11px] text-slate-600">로그 없음</div>`;
    return;
  }

  container.innerHTML = data.detections.map(d => {
    const color = d.status === 'bad' ? 'border-red-500/20 text-red-400' : d.status === 'warn' ? 'border-yellow-500/20 text-yellow-400' : 'border-green-500/20 text-green-400';
    const time = new Date(Date.now() - Math.random() * 600000);
    const ts = time.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    return `
      <div class="flex items-start gap-2 px-2 py-1.5 rounded border ${color} bg-opacity-5" style="background:rgba(0,0,0,0.2); font-size:11px;">
        <span class="text-slate-600 font-mono flex-shrink-0">${ts}</span>
        <span class="flex-1">${d.result}</span>
        <span class="text-slate-500 font-mono">#${d.frame}</span>
      </div>
    `;
  }).join('');
}

// ===== VIDEO PLAYBACK =====
document.getElementById('btnPlay').addEventListener('click', togglePlayback);
document.getElementById('btnForward').addEventListener('click', () => seekFrames(300));
document.getElementById('btnBackward').addEventListener('click', () => seekFrames(-300));
document.getElementById('btnSpeed').addEventListener('click', cycleSpeed);
document.getElementById('btnDetections').addEventListener('click', toggleDetections);
document.getElementById('progressTrack').addEventListener('click', seekToPosition);

function togglePlayback() {
  const data = towerData[selectedTower];
  if (data.totalFrames === 0) {
    showToast('분석 대기 중인 철탑입니다.');
    return;
  }

  if (isPlaying) {
    stopPlayback();
  } else {
    startPlayback();
  }
}

function startPlayback() {
  isPlaying = true;
  updatePlayButton();
  document.getElementById('scanLine').classList.add('active');

  const data = towerData[selectedTower];
  const frameStep = Math.round(10 * playSpeed);
  const intervalMs = 33; // ~30fps update rate

  playInterval = setInterval(() => {
    currentFrame += frameStep;
    if (currentFrame >= data.totalFrames) {
      currentFrame = data.totalFrames;
      stopPlayback();
    }
    updateVideoUI(data);
    updateDetectionBoxes(data);
  }, intervalMs);
}

function stopPlayback() {
  isPlaying = false;
  updatePlayButton();
  document.getElementById('scanLine').classList.remove('active');
  if (playInterval) {
    clearInterval(playInterval);
    playInterval = null;
  }
}

function updatePlayButton() {
  const icon = document.getElementById('playIcon');
  if (isPlaying) {
    icon.setAttribute('data-lucide', 'pause');
  } else {
    icon.setAttribute('data-lucide', 'play');
  }
  lucide.createIcons();
}

function seekFrames(delta) {
  const data = towerData[selectedTower];
  if (data.totalFrames === 0) return;
  currentFrame = Math.max(0, Math.min(data.totalFrames, currentFrame + delta));
  updateVideoUI(data);
  updateDetectionBoxes(data);
}

function seekToPosition(e) {
  const data = towerData[selectedTower];
  if (data.totalFrames === 0) return;
  const rect = e.currentTarget.getBoundingClientRect();
  const pct = (e.clientX - rect.left) / rect.width;
  currentFrame = Math.round(pct * data.totalFrames);
  updateVideoUI(data);
  updateDetectionBoxes(data);
}

function cycleSpeed() {
  const speeds = [0.5, 1.0, 1.5, 2.0, 4.0];
  const idx = speeds.indexOf(playSpeed);
  playSpeed = speeds[(idx + 1) % speeds.length];
  document.getElementById('btnSpeed').textContent = `${playSpeed.toFixed(1)}x`;

  // Restart if playing
  if (isPlaying) {
    stopPlayback();
    startPlayback();
  }
}

function toggleDetections() {
  showDetections = !showDetections;
  const btn = document.getElementById('btnDetections');
  if (showDetections) {
    btn.style.opacity = '1';
    btn.innerHTML = '<i data-lucide="box-select" class="w-3 h-3"></i> 탐지 표시';
  } else {
    btn.style.opacity = '0.5';
    btn.innerHTML = '<i data-lucide="box-select" class="w-3 h-3"></i> 탐지 숨김';
  }
  lucide.createIcons();
  updateDetectionBoxes(towerData[selectedTower]);
}

function updateVideoUI(data) {
  const pct = (currentFrame / data.totalFrames) * 100;
  document.getElementById('progressFill').style.width = `${pct}%`;
  document.getElementById('frameCounter').textContent = `프레임 ${currentFrame.toLocaleString()} / ${data.totalFrames.toLocaleString()}`;

  const currentSec = currentFrame / data.fps;
  const totalSec = data.totalFrames / data.fps;
  document.getElementById('timeDisplay').textContent = `${formatTime(currentSec)} / ${formatTime(totalSec)}`;

  // Update overlay detection count
  const detectedSoFar = data.detections.filter(d => d.frame <= currentFrame).length;
  document.getElementById('overlayDetCount').innerHTML = `탐지: <span class="text-yellow-400">${detectedSoFar}</span>건`;

  // Update overlay timestamp
  const base = new Date('2026-02-27T09:14:22');
  base.setSeconds(base.getSeconds() + Math.floor(currentSec));
  document.getElementById('overlayTimestamp').textContent = base.toLocaleString('ko-KR', {
    year: 'numeric', month: '2-digit', day: '2-digit',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });
}

function updateDetectionBoxes(data) {
  const container = document.getElementById('detectionBoxes');

  if (!showDetections) {
    container.innerHTML = '';
    return;
  }

  // Build boxes HTML
  let html = '';
  data.boxes.forEach((box, i) => {
    const visible = currentFrame >= box.frame;
    html += `
      <div class="detection-box ${box.color} ${visible ? 'visible' : ''}"
           style="left:${box.x}%; top:${box.y}%; width:${box.w}%; height:${box.h}%;">
        <div class="detection-label">${box.label}</div>
      </div>
    `;
  });

  container.innerHTML = html;
}

function formatTime(seconds) {
  const m = Math.floor(seconds / 60);
  const s = Math.floor(seconds % 60);
  return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

// ===== REPORT GENERATION =====
function generateReport() {
  const data = towerData[selectedTower];
  if (data.detections.length === 0) {
    showToast('분석 대기 중인 철탑입니다. 보고서를 생성할 수 없습니다.');
    return;
  }

  const bad = data.detections.filter(d => d.status === 'bad');
  const warn = data.detections.filter(d => d.status === 'warn');
  const ok = data.detections.filter(d => d.status === 'ok');
  const now = new Date();
  const dateStr = now.toLocaleString('ko-KR', { year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit' });

  const content = document.getElementById('reportContent');
  content.innerHTML = `
    <div class="space-y-5 animate-in">
      <!-- Header -->
      <div class="grid grid-cols-2 gap-3">
        <div class="p-3 rounded-lg bg-cyan-500/5 border border-cyan-500/10">
          <div class="text-[10px] text-slate-500 mb-1">철탑번호</div>
          <div class="text-sm font-bold text-white">${selectedTower}</div>
          <div class="text-[10px] text-slate-500">154kV 울산선</div>
        </div>
        <div class="p-3 rounded-lg bg-cyan-500/5 border border-cyan-500/10">
          <div class="text-[10px] text-slate-500 mb-1">점검일시</div>
          <div class="text-sm font-bold text-white">${dateStr}</div>
          <div class="text-[10px] text-slate-500">드론 자동 비행</div>
        </div>
      </div>

      <!-- Summary stats -->
      <div class="p-3 rounded-lg border border-cyan-500/10 bg-cyan-500/5">
        <div class="text-[10px] text-slate-500 mb-2 font-semibold uppercase tracking-wider">탐지 요약</div>
        <div class="grid grid-cols-4 gap-2 text-center">
          <div>
            <div class="text-xl font-bold text-cyan-400">${data.detections.length}</div>
            <div class="text-[10px] text-slate-500">총 탐지</div>
          </div>
          <div>
            <div class="text-xl font-bold text-red-400">${bad.length}</div>
            <div class="text-[10px] text-slate-500">불량</div>
          </div>
          <div>
            <div class="text-xl font-bold text-yellow-400">${warn.length}</div>
            <div class="text-[10px] text-slate-500">주의</div>
          </div>
          <div>
            <div class="text-xl font-bold text-green-400">${ok.length}</div>
            <div class="text-[10px] text-slate-500">정상</div>
          </div>
        </div>
      </div>

      <!-- Defects and warnings detail -->
      ${(bad.length > 0 || warn.length > 0) ? `
      <div>
        <div class="text-[10px] text-slate-500 mb-2 font-semibold uppercase tracking-wider">이상 항목 상세</div>
        <div class="space-y-2">
          ${[...bad, ...warn].map(d => {
            const color = d.status === 'bad' ? 'border-red-500/20 bg-red-500/5' : 'border-yellow-500/20 bg-yellow-500/5';
            const labelColor = d.status === 'bad' ? 'text-red-400' : 'text-yellow-400';
            const statusLabel = d.status === 'bad' ? '불량' : '주의';
            return `
              <div class="p-3 rounded-lg border ${color}">
                <div class="flex items-center justify-between mb-1">
                  <span class="text-xs font-bold text-white">${d.part}</span>
                  <span class="${labelColor} text-[11px] font-semibold">${statusLabel} · ${d.confidence}%</span>
                </div>
                <div class="text-[11px] text-slate-400">${d.result} · 프레임 #${d.frame.toLocaleString()}</div>
              </div>
            `;
          }).join('')}
        </div>
      </div>
      ` : ''}

      <!-- Evidence thumbnails -->
      <div>
        <div class="text-[10px] text-slate-500 mb-2 font-semibold uppercase tracking-wider">증거 이미지 (AI 캡처)</div>
        <div class="grid grid-cols-3 gap-2">
          ${data.boxes.slice(0, 3).map((box, i) => `
            <div>
              <div class="thumb-mock">
                <div style="position:relative;z-index:1;" class="text-center">
                  <i data-lucide="image" class="w-5 h-5 text-slate-600 mx-auto mb-1"></i>
                  <div class="text-[9px] text-slate-600">Frame #${data.detections[i]?.frame || ''}</div>
                </div>
                <div style="position:absolute;top:4px;left:4px;z-index:2;" class="px-1.5 py-0.5 rounded text-[8px] font-bold ${box.color === 'red' ? 'bg-red-500 text-white' : box.color === 'yellow' ? 'bg-yellow-500 text-black' : 'bg-green-500 text-white'}">${box.color === 'red' ? '불량' : box.color === 'yellow' ? '주의' : '정상'}</div>
              </div>
              <div class="text-[10px] text-slate-500 mt-1 truncate">${box.label}</div>
            </div>
          `).join('')}
        </div>
      </div>

      <!-- Full detection list -->
      <div>
        <div class="text-[10px] text-slate-500 mb-2 font-semibold uppercase tracking-wider">전체 탐지 목록</div>
        <div class="overflow-x-auto rounded-lg border border-cyan-500/10">
          <table class="data-table">
            <thead>
              <tr>
                <th>#</th>
                <th>부위</th>
                <th>결과</th>
                <th>신뢰도</th>
                <th>상태</th>
              </tr>
            </thead>
            <tbody>
              ${data.detections.map((d, i) => {
                const statusLabel = d.status === 'bad' ? '불량' : d.status === 'warn' ? '주의' : '정상';
                const statusColor = d.status === 'bad' ? 'text-red-400' : d.status === 'warn' ? 'text-yellow-400' : 'text-green-400';
                return `
                  <tr>
                    <td class="text-slate-500 font-mono text-[11px]">${i + 1}</td>
                    <td class="text-[12px]">${d.part}</td>
                    <td class="${statusColor} text-[12px]">${d.result}</td>
                    <td class="font-mono text-[11px]">${d.confidence}%</td>
                    <td class="${statusColor} text-[11px] font-semibold">${statusLabel}</td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Stamp -->
      <div class="text-center py-3 border-t border-cyan-500/10">
        <div class="text-[10px] text-slate-600">본 보고서는 AI 드론 영상 분석 시스템에 의해 자동 생성되었습니다.</div>
        <div class="text-[10px] text-slate-600 mt-0.5">생성일시: ${dateStr} · 모델: YOLOv8n · 엔진 v2.4.1</div>
      </div>
    </div>
  `;

  lucide.createIcons();

  // Show modal
  document.getElementById('reportModal').classList.add('active');
}

function closeModal() {
  document.getElementById('reportModal').classList.remove('active');
}

// Close modal on overlay click
document.getElementById('reportModal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// Close modal on Escape
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeModal();
});

// ===== INSPECTION ORDER =====
function issueInspection(tower, part) {
  showToast(`${tower} ${part} — 현장점검 지시가 발행되었습니다.`);
}

// ===== TOAST =====
function showToast(msg) {
  const toast = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  toast.classList.add('show');
  lucide.createIcons();
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// ===== KEYBOARD SHORTCUTS =====
document.addEventListener('keydown', (e) => {
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
  switch (e.key) {
    case ' ':
      e.preventDefault();
      togglePlayback();
      break;
    case 'ArrowRight':
      seekFrames(150);
      break;
    case 'ArrowLeft':
      seekFrames(-150);
      break;
    case 'd':
      toggleDetections();
      break;
  }
});
</script>
</body>
</html>
